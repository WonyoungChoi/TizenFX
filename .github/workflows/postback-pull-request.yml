name: "Postback Pull Request"

on:
  workflow_run:
    workflows: ["Build Pull Request"]
    types:
      - completed

jobs:
  postback:
    runs-on: ubuntu-latest
    steps:

    - name: Info
      run: |
        env
        echo "${{ toJson(github.event.workflow_run) }}"

    - name: Download Artifacts from Build
      uses: TizenAPI/tizenfx-build-actions/download-workflow-artifacts@master
      with:
        token: ${{ secrets.TIZENAPI_BOT_PAT }}
        run-id: ${{ github.event.workflow_run.id }}
        name: artifact
        path: Artifacts

    - name: Find Pull Request
      id: pull_request
      uses: actions/github-script@v2
      env:
        WORKFLOW_HEAD_SHA: ${{ github.event.workflow_run.head_sha }}
      with:
        script: |
          const res = await github.pulls.list({
            owner: context.repo.owner,
            repo: context.repo.repo,
            state: 'open'
          });
          if (res.status === 200) {
            const pr = res.data.find(d => d.head.sha == process.env.WORKFLOW_HEAD_SHA);
            if (pr) {
              core.setOutput('number', pr.number);
            }
          }

    - name: Show Files
      run: |
        echo "PR_NUMBER: ${{ steps.pull_request.outputs.number }}"
        ls -R
